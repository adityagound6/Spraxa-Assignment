@using AssignmentSpraxa.Portal.DTO
@model DashboardDto

@{
    ViewData["Title"] = "Home Page";

    var lastLogin = Model.LoginHistory?
        .OrderByDescending(x => x.LoginTime)
        .FirstOrDefault();

    var totalActivities = Model.LoginHistory?.Count ?? 0;
}
<div class="container mt-4">

    <!-- User Profile Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-body d-flex align-items-center">

            <img src="~/img/user-default.jpg" class="rounded-circle me-3" width="80" height="80" />

            <div>
                <h3 class="mb-1">@Model.User.Username</h3>
                <p class="text-muted mb-0">
                    @string.Join(", ", Model.User.Roles)
                </p>
                <p class="text-muted mb-0">@Model.User.Email</p>
                <p class="text-muted mb-0">@Model.User.PhoneNumber</p>
            </div>

        </div>
    </div>

    <!-- User Stats -->
    <div class="row mb-4">

        <!-- Last Login -->
        <div class="col-md-4">
            <div class="card stat-card shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-clock fa-2x mb-2"></i>
                    <h4>Last Login</h4>
                    <p class="text-muted">
                        @(
                            lastLogin != null
                            ? lastLogin.LoginTime.ToString("dd MMM yyyy, hh:mm tt")
                            : "No login history"
                         )
                    </p>
                </div>
            </div>
        </div>

        <!-- Total Activities -->
        <div class="col-md-4">
            <div class="card stat-card shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-tasks fa-2x mb-2"></i>
                    <h4>Total Activities</h4>
                    <p class="text-muted">@totalActivities</p>
                </div>
            </div>
        </div>

        <!-- Satisfaction (Static or remove if needed) -->
        <div class="col-md-4">
            <div class="card stat-card shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-heart fa-2x mb-2"></i>
                    <h4>Satisfaction</h4>
                    <p class="text-muted">94%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent User Activity -->
    <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between">
            <h4 class="mb-0">Recent Activity</h4>
        </div>

        <div class="card-body">

            @if (Model.LoginHistory == null || !Model.LoginHistory.Any())
            {
                <p class="text-muted">No recent activity found.</p>
            }
            else
            {
                foreach (var activity in Model.LoginHistory.OrderByDescending(x => x.LoginTime))
                {
                    <div class="activity-item d-flex justify-content-between mb-3">
                        <div>
                            <strong>Login from @activity.IpAddress</strong>
                            <p class="mb-0 text-muted">
                                Logged in from IP @activity.IpAddress
                            </p>
                        </div>

                        <span class="text-muted">
                            @activity.LoginTime.ToString("dd MMM yyyy, hh:mm tt")
                        </span>
                    </div>
                }
            }

        </div>
    </div>

</div>
